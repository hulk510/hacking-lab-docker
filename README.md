# hacking-lab-docker

vagrant で kali を起動しようとするとなんでか知らんけどバグで apt でパッケージをインストールできないので docker でも動く環境を作る。

## コンテナのファイルをコピーする

たまにコンテナ内のファイルを修正したりするときあるので、それを次回コンテナ作成したときにも引き継げるようにマウント設定しないといけないけどその時にファイルをコピーしたほうが楽なのでやり方忘れそうなので書いとく。

```
docker cp {コンテナ名orコンテナID}:/etc/samba/smb.conf ./docker/kali/config/samba/smb.conf
```

でコピーできる。そんなに難しくはない。ホストからコンテナに逆にコピーできるみたい。
よく使いはしないけどたまに使いそう。

### 参考

[Docker でホストとコンテナ間でのファイルコピー](https://qiita.com/gologo13/items/7e4e404af80377b48fd5)

### RFI できない

msfconsole でリバースシェルの接続を待ってても tcp コネクションを確立できない。
多分 docker になってるせいでできてないんやと思う。

# xrdp の起動

install に keyboard layout を指定する必要があるみたいで dockerfile で書いてしまうとビルド止まる。
expect とか使えばいけるんかもしれないけどめんどくさい

xfce ってデスクトップ環境を表示できるようにする奴も入れないといけないみたい。
多分ほんとかのやつは全部勝手に入ってるんかな？これを入れることで desktop 環境を表示できるっぽい。

やり方としては
https://www.kali.org/docs/general-use/xfce-with-rdp/
ここの xfce4.sh を入れて実行するだけ

```
sed -i 's/port=3389/port=3390/g' /etc/xrdp/xrdp.ini
```

これを内部で実行されてるけど 3389 にポートフォワーディングするようにしてるから

```
sed -i 's/port=3390/port=3389/g' /etc/xrdp/xrdp.ini
```

で戻しておく。

```
systemctl enable xrdp --now
```

このコマンドに関しては reboot したタイミングで起動させる設定になるんやけど今現状毎回コンテナ作ったら xfce を入れなおすようになってるからあんまりいらない。

```
/etc/init.d/xrdp start
```

これで xrdp を起動して windows の rdp（リモートデスクトップ）から接続しに行けば接続できる

ただなんでか知らないけどネットのつながりがいまいち悪い。すぐタブがクラッシュする。docker ないからインターネットはつながってるはずやけどなんかうまいこといかないんやろうか？
あとは自動でインストールして自動で起動するができてネットもちゃんとつながればベストなんやけど...
まぁ別にそれでも cli としては起動して使えるから悪くは無いと思う。
